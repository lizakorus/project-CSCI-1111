#include <stdio.h>
#define KINGS_CHAMBER 1
#define DARK_CORRIDOR 2
#define EXIT_CHAMBER 3
#define MAX_TIME 10

int main () {

    int playAgain = 1;

    // ================= REPLAY LOOP =================
    // Whole game restarts if user enters 1
    while (playAgain == 1) {

        int currentRoom = KINGS_CHAMBER;
        int timeLeft = MAX_TIME;
        int gameOver = 0;

        printf("\nYou are an archaeologist who one day wakes up in the 26th C.B.E. in the Pyramid of Giza.\n");
        printf("You are inside the tomb of Pharaoh Khufu, accidently disturbing his slumber.\n");
        printf("You must escape by navigating through The Kings Chamber, The Dark Corridor, and finally The Exit Chamber.\n");
        printf("Beware the deadly traps. Escape before time runs out.\n");
        printf("----------------------------------\n");

        // ================= MAIN GAME LOOP =================
        // Runs until player dies or time reaches 0
        while (!gameOver && timeLeft > 0) {

            switch(currentRoom) {

                // ================= ROOM 1 - KINGS CHAMBER =================
                case KINGS_CHAMBER: {

                    // Entering a room costs time
                    timeLeft--;
                    printf("Time Remaining: %d\n", timeLeft);

                    int choice;
                    int doorChoice;

                    printf("Kings Chamber:\nYou are encapsulated in darkness.\n");
                    printf("Check inventory? 1 = yes 0 = no\n");
                    scanf("%d", &choice);

                    if(choice == 0){
                        printf("You did not check inventory.\n");
                        printf("You cannot navigate in the darkness.\n");
                        gameOver = 1;
                        break;
                    }

                    // Player lights torch
                    printf("You have a torch. Light it? 1 = yes 0 = no\n");
                    scanf("%d", &choice);

                    if(choice == 0){
                        printf("You remain in darkness.\n");
                        gameOver = 1;
                        break;
                    }

                    printf("You light the torch and escape the darkness.\n");

                    // TWO DOOR CHOICE ADDED HERE
                    printf("Two doors stand before you.\n");
                    printf("One leads to certain death.\n");
                    printf("Choose wisely: 1 = Door One  0 = Door Two\n");
                    scanf("%d", &doorChoice);

                    // Choosing a door costs time
                    timeLeft--;
                    printf("Time Remaining: %d\n", timeLeft);

                    if(doorChoice == 0){
                        printf("Wrong door! Spikes shoot from the walls!\n");
                        gameOver = 1;
                    } else {
                        printf("You chose wisely.\n");
                        currentRoom = DARK_CORRIDOR;
                    }

                    break;
                }

                // ================= ROOM 2 - DARK CORRIDOR =================
                case DARK_CORRIDOR: {

                    // Entering room costs time
                    timeLeft--;
                    printf("Time Remaining: %d\n", timeLeft);

                    int choice;
                    int stayInRoom = 1;

                    printf("----------------------------------\n");

                    // stayInRoom allows replay if player falls
                    while (stayInRoom && !gameOver && timeLeft > 0) {

                        printf("\nYou are in the Dark Corridor.\nThere is a deep pit.\n");
                        printf("Check room for items? 1 = yes 0 = no\n");
                        scanf("%d", &choice);

                        // Checking costs time
                        timeLeft--;
                        printf("Time Remaining: %d\n", timeLeft);

                        if (choice == 1) {
                            printf("You found a rope!\n");
                            printf("You use it to cross safely.\n");
                            currentRoom = EXIT_CHAMBER;
                            stayInRoom = 0;

                        } else {
                            printf("You fall into the pit!\n");
                            printf("Replay room? 1 = yes 0 = no\n");
                            scanf("%d", &choice);

                            if (choice == 1) {
                                stayInRoom = 1;
                            } else {
                                gameOver = 1;
                                stayInRoom = 0;
                            }
                        }
                    }

                    break;
                }

                // ================= ROOM 3 - EXIT CHAMBER =================
                case EXIT_CHAMBER: {

                    // Entering room costs time
                    timeLeft--;
                    printf("Time Remaining: %d\n", timeLeft);

                    int choice;

                    printf("----------------------------------\n");
                    printf("Exit Chamber:\n");

                    // If time runs out immediately
                    if (timeLeft <= 0) {
                        gameOver = 1;
                        break;
                    }

                    // Search for key
                    printf("Search for Ancient Key? 1 = yes 0 = no\n");
                    scanf("%d", &choice);

                    // Searching costs time
                    timeLeft--;
                    printf("Time Remaining: %d\n", timeLeft);

                    if (choice == 0 || timeLeft <= 0) {
                        printf("You are trapped in the tomb.\n");
                        gameOver = 1;
                        break;
                    }

                    printf("You found the Ancient Key!\n");

                    // Lever puzzle setup
                    int attempts = 3;
                    int solved = 0;

                    printf("Five ancient levers stand before you.\n");
                    printf("Hint: The door opens with the number 26.\n");

                    // Player has 3 attempts and must still have time
                    while (attempts > 0 && !solved && timeLeft > 0) {

                        int l1,l2,l3,l4,l5;

                        printf("Attempts remaining: %d\n", attempts);
                        printf("Enter lever positions (1 or 0):\n");

                        scanf("%d%d%d%d%d", &l1,&l2,&l3,&l4,&l5);

                        // Each attempt costs time
                        timeLeft--;
                        printf("Time Remaining: %d\n", timeLeft);

                        if (l1==1 && l2==1 && l3==0 && l4==1 && l5==0) {
                            solved = 1;
                        } else {
                            attempts--;
                            printf("Incorrect combination.\n");
                        }
                    }

                    // Outcome logic
                    if (solved && timeLeft > 0) {

                        printf("A hidden door appears. Use key? 1 = yes 0 = no\n");
                        scanf("%d", &choice);

                        timeLeft--;
                        printf("Time Remaining: %d\n", timeLeft);

                        if (choice == 1 && timeLeft > 0) {
                            printf("You escape the pyramid!\n");
                        } else {
                            printf("You hesitate. Time runs out.\n");
                        }

                    } else {
                        printf("The Pharaoh awakens!\n");
                    }

                    // End game after Exit Chamber
                    gameOver = 1;
                    break;
                }

            } // end switch

        } // end main game loop

        // If time ran out outside Exit Chamber
        if (timeLeft <= 0 && !gameOver) {
            printf("\nTime has run out.\n");
            printf("The Pharaoh awakens!\n");
        }

        printf("----------------------------------\n");
        printf("Play again? 1 = yes 0 = no\n");
        scanf("%d", &playAgain);

    } // end replay loop

    printf("Goodbye\n");
    return 0;
}
